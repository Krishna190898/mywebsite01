<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS</title>
    <link rel="stylesheet" href="index.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>

    <div class="">

        <div class="navbar">
            <div id="logo">Mr KKR</div>

            <div id="text">
                <a href="#">Home</a>
                <a href="#">What People Say</a>
                <a href="#">How Q Works</a>
                <a href="#">Insights</a>
                <a href="#">FAQ's</a>
            </div>

            <div id="btn">
                <button id="registerBtn" onclick="goToRegister()">Register</button>
                <span id="userArea" style="display:none;"></span>


                <!-- ðŸ›’ Cart Icon -->
                <span id="cartIcon" style="margin-left:15px; cursor:pointer;">
                    ðŸ›’ <span id="cartCount">0</span>
                </span>
            </div>

        </div>

        <h2>Our Products</h2>

        <div id="productSection" style="display:none;">
            <div id="productContainer" class="products"></div>
        </div>
    </div>


    <!-- ================= SLIDE CART ================= -->

    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-header">
            <h4>My Cart</h4>
            <span onclick="closeCart()" style="cursor:pointer;">âœ–</span>
        </div>

        <div id="cartItems"></div>

        <h5 id="cartTotal"></h5>
    </div>


    <script>

        function goToRegister() {
            window.location.href = "registration.html";
        }

        window.onload = function () {

            let loginStatus = sessionStorage.getItem("isLoggedIn");
            let username = sessionStorage.getItem("username");

            if (loginStatus === "true" && username) {

                document.getElementById("registerBtn").style.display = "none";

                let userArea = document.getElementById("userArea");
                userArea.style.display = "inline";
                userArea.innerHTML = username;

                document.getElementById("productSection").style.display = "block";

                fetchProducts();
            } else {
                document.getElementById("productSection").style.display = "none";
            }

            updateCartCount();
        };



        // ================= FETCH PRODUCTS =================

        function fetchProducts() {

            fetch("https://fakestoreapi.com/products")
                .then(res => res.json())
                .then(data => {

                    let container = document.getElementById("productContainer");
                    container.innerHTML = "";

                    data.slice(0, 18).forEach(product => {

                        let card = document.createElement("div");
                        card.className = "card p-3 m-2";
                        card.style.width = "200px";
                        card.style.display = "inline-block";

                        card.innerHTML = `
                    <img src="${product.image}" width="100"><br>
                    <b>${product.title.substring(0, 20)}</b><br>
                    â‚¹ ${Number(product.price)}<br><br>
                `;

                        let btn = document.createElement("button");
                        btn.className = "btn btn-primary btn-sm";
                        btn.innerText = "Add To Cart";

                        btn.addEventListener("click", function () {
                            addToCart(product);
                        });

                        card.appendChild(btn);
                        container.appendChild(card);
                    });
                });
        }



        // ================= ADD TO CART =================

        function addToCart(product) {

            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            let existing = cart.find(item => item.id === product.id);

            if (existing) {
                existing.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    title: product.title,
                    price: Number(product.price),   // âœ… FIX
                    image: product.image,
                    quantity: 1
                });
            }

            localStorage.setItem("cart", JSON.stringify(cart));

            updateCartCount();
            openCart();
        }



        // ================= UPDATE COUNT =================

        function updateCartCount() {

            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            let totalQty = 0;

            cart.forEach(item => {
                totalQty += Number(item.quantity || 0);
            });

            document.getElementById("cartCount").innerText = totalQty;
        }



        // ================= OPEN / CLOSE CART =================

        document.getElementById("cartIcon").addEventListener("click", function () {
            openCart();
        });

        function openCart() {
            document.getElementById("cartSidebar").classList.add("active");
            displayCart();
        }

        function closeCart() {
            document.getElementById("cartSidebar").classList.remove("active");
        }



        // ================= DISPLAY CART =================

        function displayCart() {

            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let container = document.getElementById("cartItems");

            container.innerHTML = "";

            let total = 0;

            if (cart.length === 0) {
                container.innerHTML = "<p>Your cart is empty</p>";
                document.getElementById("cartTotal").innerText = "";
                return;
            }

            cart.forEach((item, index) => {

                let price = Number(item.price || 0);
                let qty = Number(item.quantity || 1);

                total += price * qty;

                let div = document.createElement("div");
                div.className = "cart-item";

                div.innerHTML = `
            <img src="${item.image}" width="60"><br>
            <b>${item.title.substring(0, 25)}</b><br>
            â‚¹ ${price}<br><br>

            <button onclick="decrease(${index})">-</button>
            ${qty}
            <button onclick="increase(${index})">+</button>

            <br><br>
            <button onclick="removeItem(${index})">Remove</button>
            <hr>
        `;

                container.appendChild(div);
            });

            document.getElementById("cartTotal").innerText = "Total: â‚¹ " + total.toFixed(2);
        }



        // ================= PLUS =================

        function increase(index) {

            let cart = JSON.parse(localStorage.getItem("cart"));

            cart[index].quantity = Number(cart[index].quantity) + 1;

            localStorage.setItem("cart", JSON.stringify(cart));

            displayCart();
            updateCartCount();
        }



        // ================= MINUS =================

        function decrease(index) {

            let cart = JSON.parse(localStorage.getItem("cart"));

            if (cart[index].quantity > 1) {
                cart[index].quantity = Number(cart[index].quantity) - 1;
            }

            localStorage.setItem("cart", JSON.stringify(cart));

            displayCart();
            updateCartCount();
        }



        // ================= REMOVE =================

        function removeItem(index) {

            let cart = JSON.parse(localStorage.getItem("cart"));

            cart.splice(index, 1);

            localStorage.setItem("cart", JSON.stringify(cart));

            displayCart();
            updateCartCount();
        }

    </script>
</body>
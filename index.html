<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mr KKR Store</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
</head>

<body>

    <div class="container-fluid p-0">

        <!-- NAVBAR -->
        <div class="navbar">

            <div id="logo">Mr KKR</div>

            <div id="text">
                <a href="#">Home</a>
                <a href="#">What People Say</a>
                <a href="#">How Q Works</a>
                <a href="#">Insights</a>
                <a href="#">FAQ</a>
            </div>

            <!-- ðŸ” SEARCH + SORT -->
            <div class="search-sort">

                <input type="text" id="searchInput" placeholder="Search product...">

                <select id="sortSelect" onchange="sortProducts()">
                    <option value="">Sort By</option>
                    <option value="low">Price: Low to High</option>
                    <option value="high">Price: High to Low</option>
                    <option value="az">Name: A to Z</option>
                    <option value="za">Name: Z to A</option>
                </select>

            </div>

            <div id="btn">
                <button id="registerBtn" onclick="goToRegister()">Register</button>
                <span id="userArea" style="display:none;"></span>

                <span id="cartIcon">
                    ðŸ›’ <span id="cartCount">0</span>
                </span>
            </div>

        </div>

        <h2 class="mt-4 text-center">Our Products</h2>

        <div id="productSection" style="display:none;">
            <div id="productContainer" class="products"></div>
        </div>

    </div>

    <!-- CART SIDEBAR -->
    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-header">
            <h4>My Cart</h4>
            <span onclick="closeCart()" style="cursor:pointer;">âœ–</span>
        </div>

        <div id="cartItems"></div>
        <h5 id="cartTotal"></h5>

        <button id="checkoutBtn" onclick="goToCheckout()">Checkout</button>
    </div>



    <!-- script Start  -->


    <script>

        let allProducts = [];

        function goToRegister() {
            window.location.href = "registration.html";
        }

        window.onload = function () {

            let loginStatus = sessionStorage.getItem("isLoggedIn");
            let username = sessionStorage.getItem("username");

            if (loginStatus === "true" && username) {
                document.getElementById("registerBtn").style.display = "none";
                let userArea = document.getElementById("userArea");
                userArea.style.display = "inline";
                userArea.innerHTML = username;
                document.getElementById("productSection").style.display = "block";
                fetchProducts();
            }

            updateCartCount();

            // ðŸ” Search Event
            document.getElementById("searchInput").addEventListener("keyup", function () {
                searchProducts(this.value);
            });
        };

        function fetchProducts() {
            fetch("https://fakestoreapi.com/products")
                .then(res => res.json())
                .then(data => {
                    allProducts = data.slice(0, 20);
                    displayProducts(allProducts);
                });
        }

        function displayProducts(products) {

            let container = document.getElementById("productContainer");
            container.innerHTML = "";

            products.forEach(product => {

                let card = document.createElement("div");
                card.className = "card product-card";

                card.innerHTML = `
            <img src="${product.image}" class="product-img" style="cursor:pointer;">
            <h6>${product.title.substring(0, 25)}</h6>
            <p class="price">â‚¹ ${Number(product.price)}</p>
            <button class="add-btn">Add To Cart</button>
        `;

                // ðŸ” Go To Product Page
                card.querySelector(".product-img").addEventListener("click", function () {
                    window.location.href = "product.html?id=" + product.id;
                });

                // ðŸ›’ ADD TO CART FIX
                card.querySelector(".add-btn").addEventListener("click", function () {
                    addToCart(product);
                });

                container.appendChild(card);
            });
        }
        // ðŸ” SEARCH FUNCTION
        function searchProducts(keyword) {

            let filtered = allProducts.filter(product =>
                product.title.toLowerCase().includes(keyword.toLowerCase())
            );

            displayProducts(filtered);
        }

        // ðŸ”½ SORT FUNCTION
        function sortProducts() {

            let value = document.getElementById("sortSelect").value;
            let sorted = [...allProducts];

            if (value === "low") {
                sorted.sort((a, b) => a.price - b.price);

            } else if (value === "high") {
                sorted.sort((a, b) => b.price - a.price);

            } else if (value === "az") {
                sorted.sort((a, b) =>
                    a.title.toLowerCase().localeCompare(b.title.toLowerCase())
                );

            } else if (value === "za") {
                sorted.sort((a, b) =>
                    b.title.toLowerCase().localeCompare(a.title.toLowerCase())
                );
            }

            displayProducts(sorted);
        }
        function addToCart(product) {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let existing = cart.find(item => item.id === product.id);

            if (existing) {
                existing.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    title: product.title,
                    price: Number(product.price),
                    image: product.image,
                    quantity: 1
                });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartCount();
        }

        function updateCartCount() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let total = 0;
            cart.forEach(item => total += item.quantity);
            document.getElementById("cartCount").innerText = total;
        }

        document.getElementById("cartIcon").addEventListener("click", openCart);

        function openCart() {
            document.getElementById("cartSidebar").classList.add("active");
            displayCart();
        }

        function closeCart() {
            document.getElementById("cartSidebar").classList.remove("active");
        }

        function displayCart() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let container = document.getElementById("cartItems");
            container.innerHTML = "";
            let total = 0;

            cart.forEach((item, index) => {

                total += item.price * item.quantity;

                let div = document.createElement("div");
                div.className = "cart-item";

                div.innerHTML = `
                <img src="${item.image}">
                <p>${item.title.substring(0, 25)}</p>
                <p>â‚¹ ${item.price}</p>
                <button onclick="decrease(${index})">-</button>
                ${item.quantity}
                <button onclick="increase(${index})">+</button>
                <br>
                <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
                `;

                container.appendChild(div);
            });

            document.getElementById("cartTotal").innerText = "Total: â‚¹ " + total.toFixed(2);
        }

        function increase(index) {
            let cart = JSON.parse(localStorage.getItem("cart"));
            cart[index].quantity++;
            localStorage.setItem("cart", JSON.stringify(cart));
            displayCart();
            updateCartCount();
        }

        function decrease(index) {
            let cart = JSON.parse(localStorage.getItem("cart"));
            if (cart[index].quantity > 1) {
                cart[index].quantity--;
            }
            localStorage.setItem("cart", JSON.stringify(cart));
            displayCart();
            updateCartCount();
        }

        function removeItem(index) {
            let cart = JSON.parse(localStorage.getItem("cart"));
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            displayCart();
            updateCartCount();
        }

        // checkout button 


        function goToCheckout() {

            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            if (cart.length === 0) {
                alert("Your cart is empty!");
                return;
            }

            window.location.href = "checkout.html";
        }
    </script>

</body>

</html>